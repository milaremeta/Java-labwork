# Java Labwork

Цей проєкт реалізує комплексну систему безпеки API з використанням JSON Web Tokens (JWT).

---

### Токен сервіс

Логіка генерації, валідації та інвалідації токенів реалізована у класі **`TokenServiceImpl.java`**.

Вміст згенерованого токену

* **Назва додатку:** Встановлено через конфігурацію (`spring.application.name`).
* **Час створення:** Фіксує точний час видачі токену.
* **Термін дії:** Встановлено на 1 годину.
* **Метадані користувача:** `user_id`, а також імітовані `username` та `email`.

Генерування токену відбувається при успішній авторизації (`/login`) та реєстрації (`/register`), і токен надається клієнту у відповіді.

Захист ендпоінтів реалізовано через **`HandlerInterceptor`** та кастомну анотацію.

### Кастомна Анотація:

* Анотація розміщена у файлі `TokenValidationRequired.java` і слугує маркером, який декларативно вказує, що метод контролера вимагає наявності валідного токену.
* Застосована до ендпоінтів `/refresh` та `/invalidate`.

### Інтерцептор

Інтерцептор виконує функції фільтра безпеки для всіх захищених шляхів:

- Визначає, чи метод вимагає анотацію **`@TokenValidationRequired`**.
- Зчитує токен із заголовка `Authorization` та перевіряє його через `TokenService.isTokenValid()`. Ця перевірка включає підпис, термін дії та чорний список (`invalidatedTokens`).
- Якщо токен дійсний, інтерцептор витягує **`userId`** і додає його в атрибути запиту (`request.setAttribute("userId", userId)`), після чого надає доступ до методу.


### Ендпойнти для управління токенами:

* **POST `/auth/refresh`:** Оновлення токену. Вимагає валідного токену. Логіка сервісу інвалідує старий токен і генерує новий.
* **POST `/auth/invalidate`:** Інвалідація токену (Logout). Вимагає валідного токену. Додає токен у чорний список.

### Логування

Усі важливі етапи роботи системи фіксуються у консолі для діагностики

* `logger.info("Користувача... Токен згенеровано.")`
* `logger.warn("Токен в списку інвалідованих")`
* `logger.info("Доступ надано для User ID: ...")`


### Юніт тестування

Для перевірки логіки сервісу створено клас **`TokenServiceImplTest.java`**. Тести підтверджують:
* Коректність генерації токену та наявність метаданих.
* Правильну роботу інвалідації.
* Стійкість до неправильних ключів.